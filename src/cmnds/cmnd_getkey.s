;----------------------------------------------------------------------
;			includes cc65
;----------------------------------------------------------------------
.feature string_escapes

.include "telestrat.inc"

;----------------------------------------------------------------------
;			includes SDK
;----------------------------------------------------------------------
.include "SDK.mac"

;----------------------------------------------------------------------
;			include application
;----------------------------------------------------------------------
;.include "macros/utils.mac"
;.include "macros/SDK-ext.mac"

;----------------------------------------------------------------------
;				imports
;----------------------------------------------------------------------
.import key

.import skip_spaces

;----------------------------------------------------------------------
;				exports
;----------------------------------------------------------------------
.export cmnd_getkey

;----------------------------------------------------------------------
;			Programme principal
;----------------------------------------------------------------------
.segment "CODE"

;----------------------------------------------------------------------
;
; Entrée:
;	X: offset sur le premier caractère suivant la commande
;
; Sortie:
;
; Variables:
;	Modifiées:
;		key
;		KBDCTC
;	Utilisées:
;		-
; Sous-routines:
;	XVIDBU
;----------------------------------------------------------------------
.proc cmnd_getkey
		; Vide le buffer clavier
                ldx     #$00
                .byte	$00, XVIDBU
		asl	KBDCTC

		; Initialise key
		lda	#$00
		sta	key
		sta	key+1

		cgetc
		asl	KBDCTC
		bcs	break

		sta	key

	break:
		clc
		rts
.endproc

